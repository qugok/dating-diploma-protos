syntax = "proto3";

import "user.proto";
import "misc.proto";

package server;

service DatingServer {
  rpc GetUser             (GetUserRequest)      returns (GetUserReply) {}
  rpc SetUser             (SetUserRequest)      returns (SetUserReply) {}
  rpc SearchAllNeighbours (NeighboursRequest)   returns (NeighboursReply) {}
  rpc FindNearest         (NearestRequest)      returns (NearestReply) {}
  rpc GetReactions        (GetReactionsRequest) returns (GetReactionsReply) {}
  rpc SetReaction         (SetReactionRequest)  returns (SetReactionReply) {}
}

message GetUserRequest {
  user.TUserKey Key = 1;
}

message GetUserReply {
  user.TUser User = 1;

  misc.EReplyStatus Status = 10;
  misc.TErrorInfo Error = 11;
}

message SetUserRequest {
  user.TUser User = 1;
}

message SetUserReply {
  misc.EReplyStatus Status = 10;
  misc.TErrorInfo Error = 11;
}

message NeighboursRequest {
  user.TGeo Geo = 1;
  string Distance = 2;
}

message NeighboursReply {
  repeated user.TUserKey Keys = 1;

  misc.EReplyStatus Status = 10;
  misc.TErrorInfo Error = 11;
}

message NearestRequest {
  user.TGeo Geo = 1;
}

message NearestReply {
  user.TUser User = 1;

  misc.EReplyStatus Status = 10;
  misc.TErrorInfo Error = 11;
}

message GetReactionsRequest {
  oneof Key {
    user.TUserKey From = 1;
    user.TUserKey To = 2;
  }
}

message GetReactionsReply {
  repeated user.TReaction Reactions = 1;

  misc.EReplyStatus Status = 10;
  misc.TErrorInfo Error = 11;
}

message SetReactionRequest {
  user.TUserKey From = 1;
  user.TUserKey To = 2;
  user.TReaction.EReactionType Reaction = 3;
}

message SetReactionReply {
  misc.EReplyStatus Status = 10;
  misc.TErrorInfo Error = 11;
}
